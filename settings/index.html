<!doctype html>
<html>
<head>
	<script type="text/javascript" src="/manager/webserver/assets/js/jquery.js"></script>
</head>
<body>

<h1 data-i18n="settings.title"></h1>

<div id="unregistered">
	<p data-i18n="settings.info"></p>

	<input class="device_id" type="text" value="/register 12345">
</div>

<div id="registered" style="display: none">

	<p id="already_bot" data-i18n="settings.already_registered"></p>
	
	<p id="already_own_bot" data-i18n="settings.already_registered_own_bot"></p>
	
	<input id="device_id_unregister" type="text" value="/unregister 12345">

</div>

<p>&nbsp;</p>

<div id="delete_bot">
	<button id="deletebot" data-i18n="delete_bot"></button>
</div>

<div id="own_bot">
	<h2 data-i18n="settings.own_bot"></h2>
	<p data-i18n="settings.own_bot_description"></p>
	<ul>
		<li data-i18n="settings.step1"></li>
		<li data-i18n="settings.step2"></li>
		<li data-i18n="settings.step3"></li>
		<li data-i18n="settings.step4"></li>
		<li data-i18n="settings.step5"></li>
		<li data-i18n="settings.step6"></li>
		<li data-i18n="settings.step7"></li>
		
	</ul>
	
	<span data-i18n="settings.token"></span>: <input type="text" name="token" id="token" value=""><button type="submit" id="submit" data-i18n="settings.save"></button>

</div>

<script type="text/javascript">

    // Initialize Homey
    function onHomeyReady() {
        Homey.ready();

        // Fill input with already stored settings
        Homey.get("device_id", function (err, value) {
            if (value) {
                $('.device_id').val('/register ' + value);
                $('#device_id_unregister').val('/unregister ' + value);
            }
        });
        
        Homey.get("chat_id", function (err, value) {
	        
	        $('#unregistered').css('display', 'none');
	        $('#registered').css('display', 'block');
	        
	    });
	    
	     Homey.get("bot_token", function (err, value) {
	        
	        if (value) {
		        $('#already_bot').css('display', 'none');
				$('#own_bot').css('display', 'none');
				$('#token').val(value);
				
				$('#deletebot').css('display', 'none');
				
	        } else {
		        $('#already_own_bot').css('display', 'none');
	        }
	    });
	    
	    $('#submit').on('click', function() {
		
			 Homey.api( 'PUT', '/addbot/', {
				 
				"bot_token": $('#token').val()
				 
			}, function( msg, result ){
				
				if (msg == 'Finished!') {
					Homey.set('bot_token', $('#token').val());
					
					$('#own_bot').css('display', 'none');
					
					alert (__("settings.success"));
					
				} else {
					alert (msg);
				}
				
			});
			
	    });
	    
	    $('#deletebot').on('click', function() {
		
			 Homey.api( 'PUT', '/deletebot/', {}, function( msg, result ){
				
				if (msg == 'Finished!') {
					
					$('#own_bot').css('display', 'true');
					$('#delete_bot').css('display', 'none');
					$('#token').val('');
					
				}
				
			});
			
	    });
	    
    }
</script>

</body>
</html>